# Example formula block for reference:
# - id: example-formula
#   title: Example Formula Title
#   category: category-name
#   tags: [tag1, tag2]
#   variables:
#     - "$x$ description of variable x"
#     - "$y$ description of variable y"
#   equation: |
#     $$
#     x = y + 1
#     $$
#   comment: "Brief explanation of the formula."
#   examples:
#     - example-comment: "Sample input and output."
#       example-equation: |
#         $$
#         x = 2, y = 1
#         $$
#
# Categories and tags help organize formulas for easy searching.
# Available category:
# - basic math
# - sales math
# - shop math
# - analysis math

# Available tags:
# - percentage
# - change
# - comparison
# - increase
# - growth
# - price
# - cost
# - margin
# - selling price
# - profit
# - discount
# - list price
# - distributor
# - customer
# - insert
# - usage
# - tool
# - manufacturing

# Percentage change formula
- id: percentage-change
  title: Percentage Change
  category: basic math
  tags: [price, cost, change]
  equation: |
    $$
    \text{Percentage Change} = \frac{P_1 - P_0}{|P_0|} \times 100\%
    $$
  variables:
    $P_0$: original value (non-zero)
    $P_1$: new value
  comment: "Percentage change measures how much a quantity has increased or \
            decreased relative to its original value, expressed as a percentage. \
            It quantifies the proportional difference between an initial value \
            and a new value, providing a normalized way to compare changes across \
            different scales."
  examples:
    - example-comment: "Original Value = 50, New Value = 75 → Percentage Change = 50%"
      example-equation: |
        $$
        \text{Percentage Change} = \frac{75 - 50}{|50|} \times 100\% = \frac{25}{50} \times 100\% = 50\%
        $$
    - example-comment: "Original Value = 80, New Value = 60 → Percentage Change = -25%"
      example-equation: |
        $$
        \text{Percentage Change} = \frac{60 - 80}{|80|} \times 100\% = \frac{-20}{80} \times 100\% = -25\%
        $$

# Percentage difference formula
- id: percentage-difference
  title: Percentage Difference
  category: basic math
  tags: [price, cost, comparison]
  equation: |
    $$
    \text{Percentage Difference} = \frac{|P_1 - P_0|}{\frac{|P_0| + |P_1|}{2}} \times 100\%
    $$
  variables:
    $P_0$: first value (non-zero)
    $P_1$: second value (non-zero)
  comment: "Percentage difference quantifies the relative difference between two values, \
            regardless of their order. It is useful for comparing the magnitude of change \
            between two quantities, providing a normalized measure of how different they are \
            relative to their average."
  examples:
    - example-comment: "Value 1 = 50, Value 2 = 75 → Percentage Difference = 40%"
      example-equation: |
        $$
        \text{Percentage Difference} = \frac{|75 - 50|}{\frac{|50| + |75|}{2}} \times 100\% = \frac{25}{62.5} \times 100\% = 40\%
        $$
    - example-comment: "Value 1 = 80, Value 2 = 60 → Percentage Difference = 28.57%"
      example-equation: |
        $$
        \text{Percentage Difference} = \frac{|60 - 80|}{\frac{|80| + |60|}{2}} \times 100\% = \frac{20}{70} \times 100\% \approx 28.57\%
        $$

############################ Sales Formulas ###################################
# Gross profit formula
- id: gross-profit
  title: Gross Profit
  category: sales math
  tags: [price, cost, profit]
  equation: |
    $$
    \text{Gross Profit} = \text{Sales Price} - \text{Cost of Goods Sold}
    $$
  comment: "Gross profit is the financial gain obtained when the selling price exceeds the cost. \
            It represents the amount of money earned after cost."
  examples:
    - example-comment: "Selling Price = $150, Cost = $100 → Gross Profit = $50"
      example-equation: |
        $$
        \text{Gross Profit} = 150 - 100 = 50
        $$

# Sales price given cost and margin
- id: sales-price-given-cost-and-margin
  title: Sales Price given Cost and Margin
  category: sales math
  tags: [profit, cost, margin]
  equation: |
    $$
    \text{Sales Price} = \frac{\text{Cost}}{1 - \text{Margin}}
    $$
  comment: "Margin is expressed as a decimal (e.g., 30% → 0.30). This formula grosses up cost to the selling price, ensuring the margin is preserved."
  examples:
    - example-comment: "Cost = $70, Margin = 0.30 → Sales Price = $100"
      example-equation: |
        $$
        \text{Sales Price} = \frac{70}{1 - 0.30} = \frac{70}{0.70} = 100
        $$

# Item cost given price and margin
- id: cost-given-price-and-margin
  title: Cost given Price and Margin
  category: sales math
  tags: [profit, cost, margin]
  equation: |
    $$
    \text{Cost} = \text{Sales Price} \times (1 - \text{Margin})
    $$
  comment: "Rearranging the price formula allows cost to be derived from price and margin.  "
  examples:
    - example-comment: "Price = $100, Margin = 0.30  → Cost = $70"
      example-equation: |
        $$
        \text{Cost} = 100 \times (1 - 0.30) = 100 \times 0.70 = 70
        $$  

# Margin given selling price and cost
- id: margin-given-price-and-cost
  title: Margin given Price and Cost
  category: sales math
  tags: [profit, cost, margin]
  equation: |
    $$
    \text{Margin} = 
    \frac{\text{Sales Price} - \text{Cost of Goods Sold}}{\text{Sales Price}} \times 100\%
    $$
  comment: "Calculates the profit margin based on the selling price and cost of \ 
            goods sold. Margin is expressed as a percentage."
  examples:
    - example-comment: |
        - List Price = $100  
        - Distributor Discount = 40% → Distributor Price = $60  
        - Customer Discount = 20% → Customer Price = $80 
      example-equation: |
        $$
        \text{Distributor Margin} = \frac{80 - 60}{80} = 0.25 \; (25\%)
        $$

######################## Analysis Formulas #################################

# Moving Average (MA)
- id: moving-average
  title: Moving Average (MA)
  category: analysis math
  tags: [product, trends, forecast]
  equation: |
    $$
    \text{Moving Average (MA)} = \frac{\sum_{i=0}^{n-1} x_{t-i}}{n}
    $$
  variables:
    $x_{t-i}$: data point at time period $t-i$
    $n$: number of periods in the moving average
  comment: |
    The moving average smooths out short-term fluctuations and highlights longer-term trends in data.
    It is commonly used in sales forecasting to identify trends over a specified number of periods.
    - Shorter MA (smaller n) → more responsive to recent changes, but more volatile
    - Longer MA (larger n) → smoother, but slower to react to changes
  examples:
    - example-comment: |
        If a product has weekly sales data: [150, 200, 250, 300, 350] and using a 3-week moving average:
        Interpretation: the 3-week moving average for week 5 is 300 units.
      example-equation:
        $$
        \text{Moving Average (MA)} = \frac{250 + 300 + 350}{3} = \frac{900}{3} = 300
        $$

# Weighted Moving Average (WMA)
- id: weighted-moving-average
  title: Weighted Moving Average (WMA)
  category: analysis math
  tags: [product, trends, forecast]
  equation: |
    $$
    \text{Weighted Moving Average} = \sum_{i=0}^{n-1} w_i \cdot x_{t-i}
    $$
  variables:
    $x_{t-i}$: data point at time period $t-i$
    $w_i$: weight for data point at time period $t-i$ (where $\sum w_i = 1$)
    $n$: number of periods in the weighted moving average
  comment: |
    The weighted moving average assigns different weights to data points, typically giving more importance to recent observations.
    This allows the average to be more responsive to recent changes while still smoothing out fluctuations.
    - Higher weights for recent data → more responsive to recent trends
    - Weights should sum to 1 or be normalized
  examples:
    - example-comment: |
        If a product has weekly sales data: [150, 200, 250, 300, 350] and using weights [0.5, 0.3, 0.2] for a 3-week weighted moving average:
        Interpretation: the weighted moving average for week 5 is 305 units.
      example-equation:
        $$
        \text{Weighted Moving Average (WMA)} = \frac{0.5 \cdot 350 + 0.3 \cdot 300 + 0.2 \cdot 250}{0.5 + 0.3 + 0.2} = \frac{175 + 90 + 50}{1.0} = 315
        $$

# Exponential Moving Average (EMA)
- id: exponential-moving-average
  title: Exponential Moving Average (EMA)
  category: analysis math
  tags: [product, trends, forecast]
  equation: |
    $$
    \text{EMA}_t = \alpha \cdot x_t + (1 - \alpha) \cdot \text{EMA}_{t-1}
    $$
  variables:
    $x_t$: data point at time period $t$
    $\text{EMA}_{t-1}$: EMA value at time period $t-1$
    $\alpha$: smoothing factor (0 < $\alpha$ ≤ 1)
  comment: |
    The exponential moving average gives more weight to recent data points, making it more responsive to recent changes.
    The smoothing factor $\alpha$ determines the rate at which older data points' influence decreases.
    - Higher $\alpha$ → more responsive to recent changes
    - Lower $\alpha$ → smoother, less responsive
  examples:
    - example-comment: |
        If a product has weekly sales data: [150, 200, 250, 300, 350] and using a smoothing factor $\alpha$=0.5:
        Interpretation: the EMA for week 5 is 325 units.
      example-equation:
        $$
        \text{EMA}_1 = 150 \\
        \text{EMA}_2 = 0.5 \cdot 200 + 0.5 \cdot 150 = 175 \\
        \text{EMA}_3 = 0.5 \cdot 250 + 0.5 \cdot 175 = 212.5 \\
        \text{EMA}_4 = 0.5 \cdot 300 + 0.5 \cdot 212.5 = 256.25 \\
        \text{EMA}_5 = 0.5 \cdot 350 + 0.5 \cdot 256.25 = 303.125
        $$  

# Coefficient of Variation (CV)
- id: coefficient-of-variation
  title: Coefficient of Variation (CV)
  category: analysis math
  tags: [product, trends, variability, comparison]
  equation: |
    $$
    \text{Coefficient of Variation (CV)} = \frac{\sigma}{\mu} \times 100
    $$
  variables:
    $\sigma$: standard deviation of the data
    $\mu$: mean of the data
  comment: |
    The coefficient of variation measures the relative variability of a dataset.
    It expresses the standard deviation as a proportion of the mean, allowing you to compare variability across products, periods, or units that may have different scales.
    - High CV → more variability relative to the mean
    - Low CV → more stable, predictable data
  examples: 
    - example-comment: |
        If a product has average weekly sales $\mu$=200 units, with standard deviation $\sigma$=50 units:
        Interpretation: weekly sales vary by 25% relative to the mean.
      example-equation:
        $$
        \text{Coefficient of Variation (CV)} = \frac{50}{200} \times 100 = .25
        $$

# Range to Mean Ratio (Range/Mean)
- id: range-to-mean-ratio
  title: Range to Mean Ratio (Range/Mean)
  category: [analysis math]
  tags: [product, trends, variability, comparison]
  equation: |
    $$
    \text{Range to Mean Ratio} = \frac{\text{Max} - \text{Min}}{\mu}
    $$
  variables:
    $\text{Max}$: maximum value in the dataset
    $\text{Min}$: minimum value in the dataset
    $\mu$: mean of the data
  comment: |
    The range to mean ratio provides a simple measure of variability by comparing the spread of the data (range) to its average level (mean).
    - High ratio → wide range relative to mean, indicating more variability
    - Low ratio → narrow range relative to mean, indicating more stability
  examples:
    - example-comment: |
        If a product has average weekly sales $\mu$=200 units, with max sales=300 units and min sales=100 units:
        Interpretation: weekly sales vary by 1.0 times the mean.
      example-equation:
        $$
        \text{Range to Mean Ratio} = \frac{300 - 100}{200} = \frac{200}{200} = 1.0
        $$

# Mean Absolute Deviation (MAD)
- id: mean-absolute-deviation
  title: Mean Absolute Deviation (MAD)
  category: analysis math
  tags: [product, trends, forecast]
  equation: |
    $$
    \text{Mean Absolute Deviation (MAD)} = \frac{\sum |x_i - \mu|}{n}
    $$
  variables:
    $x_i$: each individual data point
    $\mu$: mean of the data
    $n$: number of data points
  comment: |
    The mean absolute deviation measures the average distance between each data point and the mean.
    It provides a straightforward measure of variability that is less sensitive to extreme values than standard deviation.
    - High MAD → more variability
    - Low MAD → more stability
  examples:
    - example-comment: |
        If a product has weekly sales data: [150, 200, 250, 300, 350] with mean $\mu$=250:
        Interpretation: on average, weekly sales deviate from the mean by 70 units.
      example-equation:
        $$
        \text{Mean Absolute Deviation (MAD)} = \frac{|150-250| + |200-250| + |250-250| + |300-250| + |350-250|}{5} = \frac{100 + 50 + 0 + 50 + 100}{5} = \frac{300}{5} = 60
        $$  

# Mean Absolute Percentage Error (MAPE)
- id: mean-absolute-percentage-error
  title: Mean Absolute Percentage Error (MAPE)
  category: analysis math
  tags: [product, trends, forecast]
  equation: |
    $$
    \text{Mean Absolute Percentage Error (MAPE)} = \frac{1}{n} \sum \left| \frac{A_i - F_i}{A_i} \right| \times 100\%
    $$
  variables:
    $A_i$: actual value
    $F_i$: forecasted value
    $n$: number of data points
  comment: |
    MAPE measures the average percentage error between actual and forecasted values.
    It provides insight into the accuracy of forecasts relative to the size of the actual values. 
  examples:
    - example-comment: |
        If actual sales are [100, 200, 300] and forecasted sales are [110, 190, 310]:
        Interpretation: on average, forecast errors are about 6.67% of actual sales.
      example-equation:
        $$
        \text{Mean Absolute Percentage Error (MAPE)} = \frac{\left| \frac{100-110}{100} \right| + \left| \frac{200-190}{200} \right| + \left| \frac{300-310}{300} \right|}{3} \times 100\% = \frac{0.10 + 0.05 + 0.0333}{3} \times 100\% \approx 6.67\%
        $$

# Root Mean Square Error (RMSE)
- id: root-mean-square-error
  title: Root Mean Square Error (RMSE)
  category: analysis math
  tags: [product, trends, forecast]
  equation: |
    $$
    \text{Root Mean Square Error (RMSE)} = \sqrt{\frac{1}{n} \sum (A_i - F_i)^2}
    $$
  variables:
    $A_i$: actual value
    $F_i$: forecasted value
    $n$: number of data points
  comment: |
    RMSE measures the average magnitude of forecast errors, giving more weight to larger errors due to squaring.
    It provides insight into the accuracy of forecasts in the same units as the data.
    - Lower RMSE → better forecast accuracy
    - Higher RMSE → larger forecast errors
  examples:
    - example-comment: |
        If actual sales are [100, 200, 300] and forecasted sales are [110, 190, 310]:
        Interpretation: on average, forecast errors are about 10.0 units.
      example-equation:
        $$
        \text{Root Mean Square Error (RMSE)} = \sqrt{\frac{(100-110)^2 + (200-190)^2 + (300-310)^2}{3}} = \sqrt{\frac{100 + 100 + 100}{3}} = \sqrt{100} = 10.0
        $$  

# Forecast Bias
- id: forecast-bias
  title: Forecast Bias
  category: analysis math
  tags: [product, trends, forecast]
  equation: |
    $$
    \text{Forecast Bias} = \frac{1}{n} \sum (F_i - A_i)
    $$
  variables:
    $A_i$: actual value
    $F_i$: forecasted value
    $n$: number of data points
  comment: |
    Forecast bias measures the average difference between forecasted and actual values.
    It indicates whether forecasts tend to overestimate (positive bias) or underestimate (negative bias)
    actual outcomes.
    - Positive bias → forecasts are generally too high
    - Negative bias → forecasts are generally too low
    - Zero bias → forecasts are unbiased on average
  examples:
    - example-comment: |
        If actual sales are [100, 200, 300] and forecasted sales are [110, 190, 310]:
        Interpretation: on average, forecasts are 3.33 units higher than actual sales.
      example-equation:
        $$
        \text{Forecast Bias} = \frac{(110-100) + (190-200) + (310-300)}{3} = \frac{10 - 10 + 10}{3} = \frac{10}{3} \approx 3.33
        $$ 

# Forecast Bias Significance
- id: forecast-bias-significance
  title: Forecast Bias Significance
  category: analysis math
  tags: [product, trends, forecast]
  equation: |
    $$
    \text{Forecast Bias Significance} = \frac{\text{Forecast Bias}}{\text{RMSE}} \times 100\%
    $$
  variables:
    $\text{Forecast Bias}$: average forecast bias
    $\text{RMSE}$: root mean square error
  comment: |
    This metric assesses the significance of forecast bias relative to overall forecast accuracy (RMSE).
    It helps determine if the bias is substantial compared to the typical size of forecast errors.
    - High positive value → significant over-forecasting
    - High negative value → significant under-forecasting
    - Value near zero → bias is small relative to forecast errors
  examples:
    - example-comment: |
        If forecast bias is 3.33 units and RMSE is 10.0 units:
        Interpretation: forecast bias is about 33.3% of the typical forecast error.
      example-equation:
        $$
        \text{Forecast Bias Significance} = \frac{3.33}{10.0} \times 100\% \approx 33.3\%
        $$

# Forecast Bias Confidence Interval
- id: forecast-bias-confidence-interval
  title: Forecast Bias Confidence Interval
  category: analysis math
  tags: [product, trends, forecast]
  equation: |
    $$
    \text{Confidence Interval} = \bar{x} \pm z \left( \frac{\sigma}{\sqrt{n}} \right)
    $$
  variables:
    $\bar{x}$: forecast bias (mean of forecast errors)
    $z$: Z-score for desired confidence level (e.g., 1.96 for 95% confidence)
    $\sigma$: RMSE (standard deviation of forecast errors)
    $n$: number of data points
  comment: |
    This formula calculates the confidence interval for forecast bias, providing a range within which the true bias
    is likely to fall with a specified level of confidence.
    It accounts for the variability in forecast errors (RMSE) and the sample size (n).
  examples:
    - example-comment: |
        If forecast bias is 3.33 units, RMSE is 10.0 units, n=3, and using Z=1.96 for 95% confidence:
        Interpretation: we are 95% confident the true forecast bias lies between -8.09 and 14.75 units.
      example-equation:
        $$
        \text{Forecast Bias Confidence Interval} = 3.33 \pm 1.96 \times \frac{10.0}{\sqrt{3}} \approx 3.33 \pm 11.42
        $$
        $$
        \text{Interval} \approx [-8.09, 14.75]
        $$  

######################### Shop Math Formulas ##################################

# Insert Usage per part
- id: insert-usage-per-part
  title: Insert Usage per Part
  category: shop math
  tags: [insert, usage, tool, manufacturing]
  variables: 
    $I_p$: inserts used per part (expected, real-valued)
    $z$: number of teeth (inserts mounted in cutter body)
    $z_i$: number of usable edges per insert
    $T$: tool life (parts per insert change)
  equation: 
    $$
    I_p \;=\; \frac{\dfrac{z}{z_i}}{T} \;=\; \frac{z}{z_i\,T}
    $$
  comment: Dividing inserts by inserts by time (NEED TO REVIEW)
  examples:
    - example-comment: |
        - $I_p$ = inserts used per part (expected, real-valued)  
        - $z$ = number of teeth (inserts mounted in cutter body)  
        - $z_i$ = number of usable edges per insert  
        - $T$ = tool life (parts per insert change)                      
        This formula calculates the expected number of inserts used per part based on tool geometry and life.  
      example-equation: |
        Variables
        $$
        \text{Inserts\_needed}(N) = \left\lceil \frac{z}{z_i} \cdot \frac{N}{T} \right\rceil
        $$                  
        
        $$
        \begin{aligned}
        z &= 6,\quad z_i = 2,\quad T = 100 \\
        I_p &= \frac{6}{2\cdot 100} = 0.03\ \text{inserts/part} \\
        \text{Inserts\_consumed}(1000) &= 0.03 \times 1000 = 30 \\
        \text{Inserts\_needed}(1000) &= \left\lceil 30 \right\rceil = 30
        \end{aligned}
        $$